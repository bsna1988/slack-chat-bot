<p><div class="toc-macro client-side-toc-macro  conf-macro output-block" data-hasbody="false" data-headerelements="H1,H2,H3,H4,H5,H6,H7" data-macro-name="toc"> </div></p><h1 id="JavaTips-FAQ">FAQ</h1><h2 id="JavaTips-HowdoIconfigureSLF4J?">How do I configure SLF4J?</h2><p>To configure SLF4J in Gradle project:</p><ol><li><p class="auto-cursor-target">Add a <a class="external-link" href="https://github.com/apache/beam/blob/7940259137e20d5eb35b4be142ff628e078fe6a1/sdks/java/io/hbase/src/test/resources/log4j-test.properties" rel="nofollow">log4j-test.properties</a> under the directory of the java test.</p></li><li>Add the following snippets into your <code>build.gradle</code> file.<div class="code panel pdl conf-macro output-block" data-hasbody="true" data-macro-name="code" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Default" data-theme="Default">test {
systemProperty &quot;log4j.configuration&quot;, &quot;log4j-test.properties&quot;
}

dependencies {
shadow library.java.slf4j_api
shadow library.java.slf4j_log4j14
// or shadow library.java.slf4j_jdk12
}</pre>
</div></div><p class="auto-cursor-target">Note: as of Beam 2.53.0, Beam does not support slf4j 2.x. Make sure your slf4j dependencies are of version 1.x</p></li><li>The second dependency<code> shadow library.java.slf4j_log4j14</code> is not necessary if another library already provides this dependency.</li><li style="list-style-type: decimal;"><p class="auto-cursor-target"><span style="color: rgb(14,16,26);">Check the dependency included in the dependency tree, execute:</span> <span style="color: rgb(14,16,26);"> <br/></span></p><div class="code panel pdl conf-macro output-block" data-hasbody="true" data-macro-name="code" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Default" data-theme="Default">./gradlew dependencies.</pre>
</div></div></li><li><p class="auto-cursor-target"><span style="letter-spacing: 0.0px;">Check If you encounter an error message like the following.<br/></span></p><div class="panel conf-macro output-block" data-hasbody="true" data-macro-name="panel" style="border-style: dashed;border-width: 1px;"><div class="panelContent">
<p>SLF4J: Failed to load class &quot;org.slf4j.impl.StaticLoggerBinder&quot;.<br />SLF4J: Defaulting to no-operation (NOP) logger implementation</p>
</div></div><ol><li>If so, it<span> means there is no SLF4J.Add <strong> <code>library.java.slf4j_log4j12 </code> </strong>or<code>
            <strong> library.java.slf4j_jdk14 </strong>
          </code>in the </span> <code>build.gradle</code> <span>file.</span></li></ol></li></ol><p>To configure SLF4J in Maven project</p><ol><li><p class="auto-cursor-target">Configure the dependency in pom.xml:</p><div class="code panel pdl conf-macro output-block" data-hasbody="true" data-macro-name="code" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Default" data-theme="Default">&lt;properties&gt;
&lt;slf4j.version&gt;1.7.30&lt;/slf4j.version&gt;
&lt;/properties&gt;

&lt;dependencies&gt;
&lt;dependency&gt;
    &lt;groupId&gt;org.slf4j&lt;/groupId&gt;
    &lt;artifactId&gt;slf4j-api&lt;/artifactId&gt;
    &lt;version&gt;${slf4j.version}&lt;/version&gt;
&lt;/dependency&gt;

&lt;dependency&gt;
    &lt;groupId&gt;org.slf4j&lt;/groupId&gt;
    &lt;artifactId&gt;slf4j-jdk14&lt;/artifactId&gt;
    &lt;version&gt;${slf4j.version}&lt;/version&gt;
    &lt;!-- When loaded at runtime this will wire up slf4j to the JUL backend --&gt;
    &lt;scope&gt;runtime&lt;/scope&gt;
&lt;/dependency&gt;
&lt;dependencies&gt;</pre>
</div></div></li></ol><h2 id="JavaTips-Howtoformatcodeautomaticallyandavoidspotlesserrors?"><span style="color: rgb(14,16,26);">How to format code automatically and avoid spotless errors?</span></h2><ol><li>Set up a git pre-commit hook to always autoformat code, add the following in <code>.git/hooks/pre-commit.<br/>
      <br class="auto-cursor-target"/>
    </code></li><li>Set the executable bit.</li><li><span style="letter-spacing: 0.0px;">For more information about git hooks, go to: </span> <a class="external-link" href="https://git-scm.com/docs/githooks" rel="nofollow" style="letter-spacing: 0.0px;">https://git-scm.com/docs/githooks</a> <span style="letter-spacing: 0.0px;">.</span></li><li>To skip it, use <code>--no-verify.</code></li><li>To disable it, use `<code>chmod u-x.</code></li></ol><h2 id="JavaTips-Howtorunasingletest?">How to run a single test?</h2><ul><li class="highlight"><p class="auto-cursor-target">Example command (run from <code>beam</code> root):</p><div class="code panel pdl conf-macro output-block" data-hasbody="true" data-macro-name="code" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Default" data-theme="Default">./gradlew :examples:java:test --tests org.apache.beam.examples.subprocess.ExampleEchoPipelineTest --info</pre>
</div></div></li><li class="highlight"><p class="auto-cursor-target">To break that line down a bit:</p><ul><li class="highlight"><code>./gradlew</code><ul><li class="highlight">the Gradle wrapper that runs your code. It lives in the <code>beam</code> root, so wherever you run your command from, this path needs to point there.</li></ul></li><li class="highlight"><code>:examples:java:test</code> <ul><li class="highlight">Everything before the last colon is the path from the project root to the root of the subproject the test is in (this directory will contain a <code>build.gradle</code> file)</li><li class="highlight">The last word after the colon will always be <code>test</code> because it isn't a directory name, but the name of the Gradle task you're asking the wrapper to perform</li></ul></li><li><code>--tests</code> <ul><li>this is the option that lets you declare which specific test(s) (or test suite(s)) to run, typically using their path(s) from the <code>src/test/java</code> folder of the subproject</li></ul></li><li><code>--info</code> (optional)<ul><li>sets the log level to info</li></ul></li></ul></li><li>For more information see the documentation below on:<ul><li><a class="external-link" href="https://docs.gradle.org/current/userguide/command_line_interface.html" rel="nofollow">Gradle CLI</a></li><li><a class="external-link" href="https://docs.gradle.org/current/userguide/java_testing.html#test_filtering" rel="nofollow">Java test filtering</a></li></ul></li></ul><h2 id="JavaTips-HowtorunJavaDataflowHelloWorldpipelinewithcompiledDataflowJavaworker.">How to run Java Dataflow <code>Hello World</code> pipeline with compiled Dataflow Java worker.</h2><p>You can dump multiple definitions for a <code>gcp project</code> name and <code>temp</code> folder. They are present since different targets use different names.</p><ol><li>Before running the command, <a class="external-link" href="https://cloud.google.com/docs/authentication/getting-started" rel="nofollow">configure your gcloud credentials</a>.</li><li>Add <code>GOOGLE_APPLICATION_CREDENTIALS</code> to your <code>env</code> variables.</li><li>Execute:</li></ol><div class="code panel pdl conf-macro output-block" data-hasbody="true" data-macro-name="code" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Default" data-theme="Default">./gradlew :runners:google-cloud-dataflow-java:examples:preCommitLegacyWorker -PdataflowProject=&lt;GcpProjectName&gt; -Pproject=&lt;GcpProjectName&gt; -PgcpProject=&lt;GcpProjectName&gt; -PgcsTempRoot=&lt;Gcs location in format: gs://..., no trailing slash&gt; -PdataflowTempRoot=&lt;Gcs location in format: gs://...&gt;</pre>
</div></div><div class="code panel pdl conf-macro output-block" data-hasbody="true" data-macro-name="code" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Default" data-theme="Default">./gradlew :runners:google-cloud-dataflow-java:examples:preCommitFnApiWorker -PdataflowProject=&lt;GcpProjectName&gt; -Pproject=&lt;GcpProjectName&gt; -PgcpProject=&lt;GcpProjectName&gt;  -PgcsTempRoot=&lt;Gcs location in format: gs://..., no trailing slash&gt; -PdataflowTempRoot=&lt;Gcs location in format: gs://..., no trailing slash&gt; -PdockerImageRoot=&lt;docker image store location in format gcr.io/...&gt;</pre>
</div></div><h2 id="JavaTips-HowtorunaUserDefinedPipeline-JavaDirectRunnerexample">How to run a User Defined Pipeline - Java Direct Runner example </h2><p>If you want to run your own pipeline, and in the meanwhile change beam repo code for dev/testing purposes. <a class="external-link" href="https://github.com/HuangLED/beam/commit/98bc7404b9e1a668c4fd63dc2cc30cd14418675e" rel="nofollow">Here</a> is an example for a simple runner like directRunner:</p><ol><li>Put your pipeline code under the <code>example</code> folder.</li><li><p class="auto-cursor-target">Add the following build target to the related <code>build.gradle</code>: </p><div class="code panel pdl conf-macro output-block" data-hasbody="true" data-macro-name="code" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Default" data-theme="Default">task execute(type:JavaExec) {
main = &quot;org.apache.beam.examples.SideInputWordCount&quot;
classpath = configurations.&quot;directRunnerPreCommit&quot;
}</pre>
</div></div></li></ol><p class="auto-cursor-target"><span style="letter-spacing: 0.0px;">There are also alternative choices, with a slight difference:</span></p><p class="auto-cursor-target"><strong> <span style="letter-spacing: 0.0px;">Option 1</span> </strong></p><ol><li><p class="auto-cursor-target"><span style="letter-spacing: 0.0px;">Create a maven project. </span></p></li><li><p class="auto-cursor-target"><span style="letter-spacing: 0.0px;color: rgb(34,34,34);">Use the following command</span> <span style="letter-spacing: 0.0px;"> to publish changed code to the local repository. </span></p><div class="code panel pdl conf-macro output-block" data-hasbody="true" data-macro-name="code" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Default" data-theme="Default"> ./gradlew -Ppublishing -PnoSigning publishMavenJavaPublicationToMavenLocal</pre>
</div></div></li></ol><p class="auto-cursor-target"><strong style="letter-spacing: 0.0px;"> <span style="letter-spacing: 0.0px;">Option 2</span> </strong></p><ol><li><span style="letter-spacing: 0.0px;">Make use of Integration tests.</span></li><li><span style="letter-spacing: 0.0px;">Make your user-defined pipeline part of the integration test. </span></li></ol><h2 id="JavaTips-HowtouseasnapshotBeamJavaSDKversion?">How to use a snapshot Beam Java SDK version?</h2><p>To use snapshot BEAM new features prior to the next Beam release,<span> you need to;</span></p><ol><li><span>Add the <code>apache.snapshots</code> repository to your <code>pom.xml.</code> Check this </span> <a class="external-link" href="https://github.com/GoogleCloudPlatform/DataflowTemplates/blob/bfd8b792985e9e6b3a56622d1531da14e9106c83/pom.xml#L890" rel="nofollow"> <span>example</span> </a>.</li><li><span>Set <code>beam.version</code> to a snapshot version, e.g. &quot;2.24.0-SNAPSHOT&quot; or later (</span> <a class="external-link" href="https://repository.apache.org/content/groups/snapshots/org/apache/beam/beam-sdks-java-core/" rel="nofollow"> <span>listed here</span> </a> <span>).</span></li></ol><p><br/></p><p><br/></p><h1 id="JavaTips-CommonErrors">Common Errors</h1><h2 id="JavaTips-Continueonerror"><code>Continue on error</code></h2><p>Use the <code>--continue</code> flag makes to compileJava task and to dump all found errors, not stop on first.</p><h2 id="JavaTips-IntelliJProtoIntellisensedoesn&#39;twork.">IntelliJ Proto Intellisense doesn't work.</h2><p>This can happen when you start IntelliJ or (in my case) after modifying <code>protos</code>.</p><p>This is not a solved problem yet. But here are some current approaches:</p><ol><li>Clean <code>build</code> from console</li><li>Build from IntelliJ</li><li>Refresh Gradle Project in IntelliJ</li><li>Restart IntelliJ</li><li>Another option is if <code>index</code> is not updated with 3 or 4 steps. For more information, go to <a class="external-link" href="https://stackoverflow.com/questions/6652540/rebuild-intellij-project-indexes" rel="nofollow">Rebuild IntelliJ project indexes</a>.</li></ol><p>A workaround that did the trick. Since many things were tried in the process and no clear way to reproduce the error, this might not be the correct or best step. Update steps if you find a shorter or cleaner way to do the trick.</p><ol><li><p class="auto-cursor-target">Refresh <code>gradle</code> project in IntelliJ.</p></li><li>Close Intellij.</li><li><p class="auto-cursor-target">Clean build project from the console. Execute&gt;<br/><br/></p><div class="code panel pdl conf-macro output-block" data-hasbody="true" data-macro-name="code" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Default" data-theme="Default">./gradlew clean cleanTest build -x testWebsite -x :rat -x test</pre>
</div></div></li><li>Open IntelliJ.</li></ol><h2 id="JavaTips-BuilderrorsduetoinconsistentGradlecache">Build errors due to inconsistent Gradle cache</h2><p>Sometimes build fails even for the main (master) branch either using IntelliJ or command line. If it worked before but now consistently failing, most likely this is due to inconsistent Gradle cache. It could happen when switching branches back and forth. Run the build Gradle command line with &quot;<span style="color: rgb(12,13,14);">--rerun-tasks&quot; would do the trick.</span></p><h2 id="JavaTips-WhatcommandshouldIrunlocallybeforecreatingapullrequest?">What command should I run locally before creating a pull request?</h2><p>We recommend running this command, in order to catch common style issues, potential bugs (using code analysis), and Javadoc issues before creating a pull request. Running this takes 5 to 10 minutes.</p><div class="code panel pdl conf-macro output-block" data-hasbody="true" data-macro-name="code" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Default" data-theme="Default">./gradlew spotlessApply &amp;&amp; ./gradlew -PenableCheckerFramework=true checkstyleMain checkstyleTest javadoc spotbugsMain compileJava compileTestJava</pre>
</div></div><p>If you don't run this locally Jenkins will run them during pre-submit. However, if these fail during pre-submit, you may not see the output of test failures. So doing this first is recommended to make your development process a bit smoother and iterate on your PR until it passes the pre-submit.</p><h1 id="JavaTips-DependencyUpgrades">Dependency Upgrades</h1><p><div class="error"><span class="error">Unable to render {include}</span> The included page could not be found.</div></p><p><br/></p><p><br/></p><p><br/></p><p><br/></p>