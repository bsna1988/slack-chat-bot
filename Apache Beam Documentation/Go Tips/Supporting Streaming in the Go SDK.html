<p>As of October 2020 the area the Go SDK is most lacking is supporting streaming operation. This page intends to operate as a guide to areas related to streaming support that need contributions. Specific tasks are linked to their related JIRAs which have been updated with places to start looking for independent, orthogonal work.<br/><br/>These are<span> </span><strong>not recommended as &quot;starter&quot; or &quot;newbie&quot; tasks</strong><span> </span>as many require understanding of the <a class="external-link" href="https://beam.apache.org/documentation/programming-guide" rel="nofollow">Beam Model</a>, and the Go Programming Language to implement. In particular, understanding the<span> </span><a class="external-link" href="https://beam.apache.org/documentation/runtime/model/" rel="nofollow" style="text-decoration: none;">runtime execution model </a>is critical in the implementation of these features, as well as understanding the<span> </span><a class="external-link" href="https://github.com/apache/beam/tree/master/sdks/go/pkg/beam/core/runtime/exec" rel="nofollow" style="text-decoration: none;">Go SDK's exec package</a><span> </span>which implements it. </p><p>As always, the right place to get help is from the #beam-go slack channel, or the dev@ mailing list, referring to the JIRA you're interested in working on. </p><p>As Apache Beam is a unified model for batch and stream processing, supporting streaming is not simply adding a single feature, it's adding several features. The Go SDK during execution is generally unaware whether the bundle it's processing is &quot;streaming&quot; or not. As such, advanced features like<span> </span><a class="external-link" href="https://beam.apache.org/documentation/programming-guide/#side-inputs" rel="nofollow" style="text-decoration: none;">Side Inputs,</a><span> </span>and<span> </span><a class="external-link" href="https://beam.apache.org/documentation/programming-guide/#state-and-timers" rel="nofollow" style="text-decoration: none;">State and Timers</a> will work just as well for batch execution as for streaming execution. However, the nature of streaming makes certain improvements and optimizations more impactful for streaming, which is why they are mentioned here. </p><p>Previous development has been focused on efficient execution within a batch global window environment, which is why the following hasn't been worked on yet. </p><h2 id="SupportingStreamingintheGoSDK-Overview">Overview</h2><p>To get to streaming, we first need to validate the Go SDK's windowing implementation. While streaming can in principle operate only the global window, it by necessity means that all pcollections are bounded, which makes them of limited use in streaming contexts. So, first, windowing, as this gives us correct processing of data in a context that's useful for streaming.</p><p>Once we're assured that we're correctly processing the data WRT windows, we can work on getting data into the pipeline. The Go SDK can't currently produce streaming data. There are two options, native and cross language. Native requires augmenting related to Splittable DoFns with the ability to estimate watermarks and self checkpoint. This allows Go SDK users to author scalable streaming source DoFns in Go. Cross Language requires completing the cross language support implementation, and wrapping the already implemented streaming source DoFns from Java and Python, and making them available in the appropriate expansion service, and sibling package in the Go SDK. Both are valid and appropriate avenues to enable injestion of streaming data into a Go SDK pipeline.</p><p>At this point, we would have a minimum viable product to use the Go SDK in streaming pipelines. However, streaming pipelines are more performance sensitive than batch pipelines. Latency requirements are often stricter,  bundles are generally smaller, and the value of caching is higher.</p><p>To that end, improving the performance of side inputs via the Beam cache token mechanism, and adding random access side inputs as a user API helps improve efficiency. Further, features that really shine in streaming contexts will have more cause to be implemented, such as custom windowing, Triggers, and State and Timers, which enable additional native uses.<span> </span></p><h2 id="SupportingStreamingintheGoSDK-Details">Details</h2><p><br/></p><p>The rest of this page divides the work into broad feature related categories, outlining the feature, it's state at time of writing (October 2020), and links to their JIRAs. Other than validating windowing correctness, the remaining sections are largely independent and can be implemented in any order.<span> </span><strong>Testing and documentation are required</strong><span> </span>as well for successful completion of these tasks, but mentioned only in the JIRAs to reduce repetition here.</p><p>It's strongly recommended to develop these features against a fully vetted runner like the Python Portable Runner.<strong> See <a href="/confluence/display/BEAM/Go+Tips">Go Tips</a> for guidance on getting started using that.</strong></p><p><strong>Once the tasks marked [MVP] are accomplished, the SDK will support basic streaming.</strong></p><h3 id="SupportingStreamingintheGoSDK-ValidateWindowing[MVP][Correctness]ASFJIRA5aa69414-a9e9-3523-82ec-879b028fb15bBEAM-11084"><strong>Validate Windowing [MVP] [Correctness] 
<span class="jira-issue conf-macro output-block" data-client-id="SINGLE_5aa69414-a9e9-3523-82ec-879b028fb15b_165221827_073590d28789c11c0187b3346f63006f" data-hasbody="false" data-jira-key="BEAM-11084" data-macro-name="jira">
                    <a href="https://issues.apache.org/jira/browse/BEAM-11084" class="jira-issue-key"><span class="aui-icon aui-icon-wait issue-placeholder"> </span>BEAM-11084</a>
                            -
            <span class="summary">Getting issue details...</span>
                                                <span class="aui-lozenge aui-lozenge-subtle aui-lozenge-default issue-placeholder">STATUS</span>
                </span>
</strong></h3><p><span>Foremost is work in validating that the existing streaming and windowing code is correct in the SDK.  The SDK permits emitting and observing event times and observing windows in DoFns.</span></p><ul><li><span>Validate that users can observe windows in their DoFns explicitly.<strong>[MVP] </strong> 
<span class="jira-issue conf-macro output-block" data-client-id="SINGLE_5aa69414-a9e9-3523-82ec-879b028fb15b_165221827_073590d28789c11c0187b3346f63006f" data-hasbody="false" data-jira-key="BEAM-11085" data-macro-name="jira">
                    <a href="https://issues.apache.org/jira/browse/BEAM-11085" class="jira-issue-key"><span class="aui-icon aui-icon-wait issue-placeholder"> </span>BEAM-11085</a>
                            -
            <span class="summary">Getting issue details...</span>
                                                <span class="aui-lozenge aui-lozenge-subtle aui-lozenge-default issue-placeholder">STATUS</span>
                </span>
</span></li><li><span>Validate existing windowing code is correct for simple GBKs and </span><span>lifted combiners work.<strong>[MVP] </strong> 
<span class="jira-issue conf-macro output-block" data-client-id="SINGLE_5aa69414-a9e9-3523-82ec-879b028fb15b_165221827_073590d28789c11c0187b3346f63006f" data-hasbody="false" data-jira-key="BEAM-11086" data-macro-name="jira">
                    <a href="https://issues.apache.org/jira/browse/BEAM-11086" class="jira-issue-key"><span class="aui-icon aui-icon-wait issue-placeholder"> </span>BEAM-11086</a>
                            -
            <span class="summary">Getting issue details...</span>
                                                <span class="aui-lozenge aui-lozenge-subtle aui-lozenge-default issue-placeholder">STATUS</span>
                </span>
</span></li><ul><li><span>In particular sliding (multiple overlapping) windows where a single element could contribute to multiple aggregates.</span></li></ul><li><span>Validate Side Input behavior WRT windows. (implicit observation of windows).<strong>[MVP] </strong> 
<span class="jira-issue conf-macro output-block" data-client-id="SINGLE_5aa69414-a9e9-3523-82ec-879b028fb15b_165221827_073590d28789c11c0187b3346f63006f" data-hasbody="false" data-jira-key="BEAM-11087" data-macro-name="jira">
                    <a href="https://issues.apache.org/jira/browse/BEAM-11087" class="jira-issue-key"><span class="aui-icon aui-icon-wait issue-placeholder"> </span>BEAM-11087</a>
                            -
            <span class="summary">Getting issue details...</span>
                                                <span class="aui-lozenge aui-lozenge-subtle aui-lozenge-default issue-placeholder">STATUS</span>
                </span>
</span></li><ul><li><span>Side Inputs are valid per window, and this should be validated and tested to be true for the Go SDK.</span></li></ul></ul><h3 id="SupportingStreamingintheGoSDK-TestingStreamingASFJIRA5aa69414-a9e9-3523-82ec-879b028fb15bBEAM-11088"><span>Testing Streaming  
<span class="jira-issue conf-macro output-block" data-client-id="SINGLE_5aa69414-a9e9-3523-82ec-879b028fb15b_165221827_073590d28789c11c0187b3346f63006f" data-hasbody="false" data-jira-key="BEAM-11088" data-macro-name="jira">
                    <a href="https://issues.apache.org/jira/browse/BEAM-11088" class="jira-issue-key"><span class="aui-icon aui-icon-wait issue-placeholder"> </span>BEAM-11088</a>
                            -
            <span class="summary">Getting issue details...</span>
                                                <span class="aui-lozenge aui-lozenge-subtle aui-lozenge-default issue-placeholder">STATUS</span>
                </span>
</span></h3><p><span>Beam runners can support a 'TestStream&quot; primitive to emulate a streaming datasource for testing. This stands to make other tasks in this set much easier to implement. </span></p><ul><li><span>Add TestStream support to allow simpler writing of “streaming” based tests against runners.</span></li></ul><h3 id="SupportingStreamingintheGoSDK-GoSDKNativeStreamingSourceDoFns[MVPNative]"><strong>Go SDK Native Streaming Source DoFns [MVP Native]</strong></h3><p><span>At present it’s not possible to write Streaming Source DoFns. Ordinary DoFns work just fine for transforms that do not have significant fanout of downstream elements (high outputs per input) or have high processing time per fraction of elements (expensive outputs per input). SplittableDoFns help divide work of a single element in terms of their output elements across multiple workers, but can’t serve as more than a single bundle source. It’s necessary to be able to split a single bundle into multiple bundles not just in the work domain, but also across the time domain.</span></p><p><span>To enable native Go streaming sources we would need to add at least self checkpointing and watermark estimation support, but additional related features can make the DoFns more versatile.</span></p><ul><li><span>DoFn Self Checkpointing </span><strong>[MVP] 
<span class="jira-issue conf-macro output-block" data-client-id="SINGLE_5aa69414-a9e9-3523-82ec-879b028fb15b_165221827_073590d28789c11c0187b3346f63006f" data-hasbody="false" data-jira-key="BEAM-11104" data-macro-name="jira">
                    <a href="https://issues.apache.org/jira/browse/BEAM-11104" class="jira-issue-key"><span class="aui-icon aui-icon-wait issue-placeholder"> </span>BEAM-11104</a>
                            -
            <span class="summary">Getting issue details...</span>
                                                <span class="aui-lozenge aui-lozenge-subtle aui-lozenge-default issue-placeholder">STATUS</span>
                </span>
</strong></li><ul><li><span>Allows DoFn to terminate a bundle, and tell the runner how  to restart processing elsewhere. Can be considered “splitting in time” but purposely permits a DoFn to finish a bundle.</span></li></ul><li><span>Watermark Estimation <strong>[MVP] 
<span class="jira-issue conf-macro output-block" data-client-id="SINGLE_5aa69414-a9e9-3523-82ec-879b028fb15b_165221827_073590d28789c11c0187b3346f63006f" data-hasbody="false" data-jira-key="BEAM-11105" data-macro-name="jira">
                    <a href="https://issues.apache.org/jira/browse/BEAM-11105" class="jira-issue-key"><span class="aui-icon aui-icon-wait issue-placeholder"> </span>BEAM-11105</a>
                            -
            <span class="summary">Getting issue details...</span>
                                                <span class="aui-lozenge aui-lozenge-subtle aui-lozenge-default issue-placeholder">STATUS</span>
                </span>
</strong></span><ul><li>Sets the minimum output watermark for a given restriction+element based on element timestamps or an external clock.</li></ul></li><li><span>Truncating SDFs during drain 
<span class="jira-issue conf-macro output-block" data-client-id="SINGLE_5aa69414-a9e9-3523-82ec-879b028fb15b_165221827_073590d28789c11c0187b3346f63006f" data-hasbody="false" data-jira-key="BEAM-11106" data-macro-name="jira">
                    <a href="https://issues.apache.org/jira/browse/BEAM-11106" class="jira-issue-key"><span class="aui-icon aui-icon-wait issue-placeholder"> </span>BEAM-11106</a>
                            -
            <span class="summary">Getting issue details...</span>
                                                <span class="aui-lozenge aui-lozenge-subtle aui-lozenge-default issue-placeholder">STATUS</span>
                </span>
</span><ul><li><span>Allows for more aggressive shrinking of restrictions during a drain.</span></li></ul></li><li><span>Bundle Finalization 
<span class="jira-issue conf-macro output-block" data-client-id="SINGLE_5aa69414-a9e9-3523-82ec-879b028fb15b_165221827_073590d28789c11c0187b3346f63006f" data-hasbody="false" data-jira-key="BEAM-10976" data-macro-name="jira">
                    <a href="https://issues.apache.org/jira/browse/BEAM-10976" class="jira-issue-key"><span class="aui-icon aui-icon-wait issue-placeholder"> </span>BEAM-10976</a>
                            -
            <span class="summary">Getting issue details...</span>
                                                <span class="aui-lozenge aui-lozenge-subtle aui-lozenge-default issue-placeholder">STATUS</span>
                </span>
 </span><ul><li><span>Allows a callback to be registered and side effects performed after bundle completion. For example, to acknowledge messages received from a message broker (kafka, Cloud PubSub) after the bundle results are persisted.</span></li></ul></li></ul><h3 id="SupportingStreamingintheGoSDK-CrossLanguageStreamingSourceDoFns[MVPXlang]"><strong>Cross Language Streaming Source DoFns [MVP Xlang] </strong></h3><ul><li><span>Clean up Prototype code 
<span class="jira-issue conf-macro output-block" data-client-id="SINGLE_5aa69414-a9e9-3523-82ec-879b028fb15b_165221827_073590d28789c11c0187b3346f63006f" data-hasbody="false" data-jira-key="BEAM-9918" data-macro-name="jira">
                    <a href="https://issues.apache.org/jira/browse/BEAM-9918" class="jira-issue-key"><span class="aui-icon aui-icon-wait issue-placeholder"> </span>BEAM-9918</a>
                            -
            <span class="summary">Getting issue details...</span>
                                                <span class="aui-lozenge aui-lozenge-subtle aui-lozenge-default issue-placeholder">STATUS</span>
                </span>
</span></li><li><span>Provide example wrappers of existing XLang DoFns, </span></li><ul><li><span>like the Java Kafka transform.</span></li><li><span>Wrap advanced State and Timers transforms form Java and Python to allow their use in Go SDK pipelines - eg. GroupIntoBatches.</span><strong> </strong></li></ul></ul><h3 id="SupportingStreamingintheGoSDK-SideInputs[Performance]"><strong>Side Inputs [Performance]</strong></h3><p><span>Side inputs are a valuable feature for affecting computation with additional pipeline computed data. However they can also affect performance significantly.</span></p><p><span>At present, the Go SDK supports iterable side inputs, and they’re looked up from the runner every time.</span></p><ul><li><span>Side Input Caching using tokens. 
<span class="jira-issue conf-macro output-block" data-client-id="SINGLE_5aa69414-a9e9-3523-82ec-879b028fb15b_165221827_073590d28789c11c0187b3346f63006f" data-hasbody="false" data-jira-key="BEAM-11097" data-macro-name="jira">
                    <a href="https://issues.apache.org/jira/browse/BEAM-11097" class="jira-issue-key"><span class="aui-icon aui-icon-wait issue-placeholder"> </span>BEAM-11097</a>
                            -
            <span class="summary">Getting issue details...</span>
                                                <span class="aui-lozenge aui-lozenge-subtle aui-lozenge-default issue-placeholder">STATUS</span>
                </span>
</span></li><ul><li><span>Side inputs are valid based on the window. Multiple elements and bundles processed in the same window can reuse the same side input data at the runner’s discretion. This is implemented with a key token. </span></li><li><span>This is critical for Streaming performance to reduce data interchange with the Runner half of a worker.</span><span><br/></span></li></ul><li><span>Map Side Inputs / Random Access Side Inputs. 
<span class="jira-issue conf-macro output-block" data-client-id="SINGLE_5aa69414-a9e9-3523-82ec-879b028fb15b_165221827_073590d28789c11c0187b3346f63006f" data-hasbody="false" data-jira-key="BEAM-3293" data-macro-name="jira">
                    <a href="https://issues.apache.org/jira/browse/BEAM-3293" class="jira-issue-key"><span class="aui-icon aui-icon-wait issue-placeholder"> </span>BEAM-3293</a>
                            -
            <span class="summary">Getting issue details...</span>
                                                <span class="aui-lozenge aui-lozenge-subtle aui-lozenge-default issue-placeholder">STATUS</span>
                </span>
</span></li><ul><li><span>KV PCollections as side inputs currently support an iterable approach, however the beam protocol does support a Key Lookup approach as well.</span></li><li><span>This enables having significantly larger side inputs, as data can be looked up from the runner as needed, rather than possibly iterating over the entire PCollection for every element.</span></li><li><span>Similarly, an advanced feature would be to support ViewFns for side inputs user side processing of side inputs, orchestrated and garbage collected by the framework, rather than requiring users to do so manually.  
<span class="jira-issue conf-macro output-block" data-client-id="SINGLE_5aa69414-a9e9-3523-82ec-879b028fb15b_165221827_073590d28789c11c0187b3346f63006f" data-hasbody="false" data-jira-key="BEAM-3305" data-macro-name="jira">
                    <a href="https://issues.apache.org/jira/browse/BEAM-3305" class="jira-issue-key"><span class="aui-icon aui-icon-wait issue-placeholder"> </span>BEAM-3305</a>
                            -
            <span class="summary">Getting issue details...</span>
                                                <span class="aui-lozenge aui-lozenge-subtle aui-lozenge-default issue-placeholder">STATUS</span>
                </span>
</span></li></ul></ul><p><br/></p><h3 id="SupportingStreamingintheGoSDK-Windowing[Basic]"><strong>Windowing [Basic]</strong></h3><p><span>FlumeGo supports simple fixed interval windowing, and global windows. The validation mentioned above needs to be handled before sliding windows can be declared to be correctly supported.</span></p><ul><li><span>Complete  Session Windowing plumbing 
<span class="jira-issue conf-macro output-block" data-client-id="SINGLE_5aa69414-a9e9-3523-82ec-879b028fb15b_165221827_073590d28789c11c0187b3346f63006f" data-hasbody="false" data-jira-key="BEAM-4152" data-macro-name="jira">
                    <a href="https://issues.apache.org/jira/browse/BEAM-4152" class="jira-issue-key"><span class="aui-icon aui-icon-wait issue-placeholder"> </span>BEAM-4152</a>
                            -
            <span class="summary">Getting issue details...</span>
                                                <span class="aui-lozenge aui-lozenge-subtle aui-lozenge-default issue-placeholder">STATUS</span>
                </span>
</span></li><li><span>Implement Custom Windowing 
<span class="jira-issue conf-macro output-block" data-client-id="SINGLE_5aa69414-a9e9-3523-82ec-879b028fb15b_165221827_073590d28789c11c0187b3346f63006f" data-hasbody="false" data-jira-key="BEAM-11100" data-macro-name="jira">
                    <a href="https://issues.apache.org/jira/browse/BEAM-11100" class="jira-issue-key"><span class="aui-icon aui-icon-wait issue-placeholder"> </span>BEAM-11100</a>
                            -
            <span class="summary">Getting issue details...</span>
                                                <span class="aui-lozenge aui-lozenge-subtle aui-lozenge-default issue-placeholder">STATUS</span>
                </span>
</span></li><ul><li><span>Requires special handling and encoding to the windowing space, notably in how to merge windows together SDK side. Likely handled as a special WindowFn struct with specialized method names, similar to DoFns and CombineFns.</span></li></ul></ul><p><br/></p><h3 id="SupportingStreamingintheGoSDK-Triggers[Basic]ASFJIRA5aa69414-a9e9-3523-82ec-879b028fb15bBEAM-3304"><strong>Triggers [Basic]  
<span class="jira-issue conf-macro output-block" data-client-id="SINGLE_5aa69414-a9e9-3523-82ec-879b028fb15b_165221827_073590d28789c11c0187b3346f63006f" data-hasbody="false" data-jira-key="BEAM-3304" data-macro-name="jira">
                    <a href="https://issues.apache.org/jira/browse/BEAM-3304" class="jira-issue-key"><span class="aui-icon aui-icon-wait issue-placeholder"> </span>BEAM-3304</a>
                            -
            <span class="summary">Getting issue details...</span>
                                                <span class="aui-lozenge aui-lozenge-subtle aui-lozenge-default issue-placeholder">STATUS</span>
                </span>
</strong></h3><p><span>Triggers are special runner side behavior indicating how to handle data WRT the watermark and window. Commonly configuring the processing for “late data” and similar.</span></p><p><span>These are not currently implemented for user use in the Go SDK. Reshuffle configures triggers, but it’s not accessible. A correct trigger implementation can at least re-implement Reshuffle in a user pipeline, rather than handled specially within the framework.</span></p><ul><li><span>Requires extending the window package to be able to configure the various triggers.</span></li><ul><li><span>Specifically being able to compose triggers as also permitted by the proto.</span></li></ul><li><span>Requires updating the graphx package translate.go to marshal (and unmarshal?) the triggers to and from Beam PipelineProto Windowing strategies.</span></li><li><span>Requires supporting triggers with the beam.WindowInto transform for user pipeline use.</span></li><li><span>Extension: Handle pane propagation and observation in the exec package, and in user dofns. </span></li><ul><li><span>Panes indicate whether data was on time or not, and similar facets.</span></li><li><span>Might simply extend the existing window interface.</span></li></ul></ul><p><br/></p><h3 id="SupportingStreamingintheGoSDK-StateandTimers[Advanced]ASFJIRA5aa69414-a9e9-3523-82ec-879b028fb15bBEAM-10660"><strong>State and Timers [Advanced] 
<span class="jira-issue conf-macro output-block" data-client-id="SINGLE_5aa69414-a9e9-3523-82ec-879b028fb15b_165221827_073590d28789c11c0187b3346f63006f" data-hasbody="false" data-jira-key="BEAM-10660" data-macro-name="jira">
                    <a href="https://issues.apache.org/jira/browse/BEAM-10660" class="jira-issue-key"><span class="aui-icon aui-icon-wait issue-placeholder"> </span>BEAM-10660</a>
                            -
            <span class="summary">Getting issue details...</span>
                                                <span class="aui-lozenge aui-lozenge-subtle aui-lozenge-default issue-placeholder">STATUS</span>
                </span>
 </strong></h3><p><span>The Go SDK currently doesn’t have any state and timers support. </span></p><p><a class="external-link" href="https://beam.apache.org/documentation/programming-guide/#state-and-timers" rel="nofollow" style="text-decoration: none;"><span>State and Timers</span></a><span> is an API for manually managing per-key state allowing for fine-grain control over aggregations. State is scoped per key + window. Event Time Timers allow manipulation of the output watermark, and respond to the input watermark while processing time timers allow responding to wall time events, allowing advanced transforms like Group Into Batches.</span></p><ul><li><span>Design an idiomatic Go approach to Timers and State processing for DoFns</span><ul><li><span>Go doesn’t support annotation like constructs, with the exception of struct field tags so</span> <ul><li><span>Design likely requires new framework side marker types</span></li><li>Design likely requires using field tags.</li></ul></li><li><span>State concerns:</span><ul><li><span>Needs to allow customization for state types. (easier post generics in Go, but an design that doesn’t require that would be viable sooner)</span></li><li><span>Should support deferred batch reads of multiple states</span></li><li><span>Needs to be expandable to handle ValueState, Combining State, and BagState</span></li></ul></li><li><span>Timer concerns: </span><ul><li><span>Needs to handle Event and Processing Time timers.</span></li><li><span>Dynamic Timer tags (likely the one and only way to handle Go SDK timers)</span></li><li><span>Needs to introduce an “OnTimer” method, and associated validation.</span></li></ul></li></ul></li></ul><p><br/></p>