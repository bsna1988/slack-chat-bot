<h2 id="DependencymanagementguidelinesforBeamPythonSDKmaintainers-Howtoupdatedependencyversions?"><span><div class="toc-macro client-side-toc-macro  conf-macro output-block" data-hasbody="false" data-headerelements="H1,H2,H3,H4,H5,H6,H7" data-macro-name="toc"> </div>How to update dependency versions?</span></h2><ul><li style="list-style-type: none;"><ul><li><span>We expect that the majority of upgrades will be done via merging of automated Dependabot PRs. </span></li><li><span>When reviewing a dependency update PR, note that increasing an upper bound may not be sufficient to exercise the new version in integration test suites. Committers can temporarily include a commit to a PR that increases the </span><strong>lower </strong><span>for a dependency, run integration tests, once they pass, remove the lower bound constraint. Sample PR that followed this process: </span><a class="external-link" href="https://github.com/apache/beam/pull/25786/commits" rel="nofollow"><span>https://github.com/apache/beam/pull/25786/commits</span></a><span>. See an example of a PR review that followed this process, and identified a breaking change: </span><a class="external-link" href="https://github.com/apache/beam/pull/17615" rel="nofollow"><span>https://github.com/apache/beam/pull/17615</span></a><span>.</span></li></ul></li></ul><h2 id="DependencymanagementguidelinesforBeamPythonSDKmaintainers-Whentoupdatetheversions?"><span>When to update the versions?</span></h2><ul><li style="list-style-type: none;"><ul><li><span>Depending on old versions of our dependencies is an inconvenience to users and can be a ticking time bomb (</span><a class="external-link" href="https://s.apache.org/beam-python-dependencies-pm" rel="nofollow"><span>https://s.apache.org/beam-python-dependencies-pm</span></a><span>).</span></li><li><span>Be proactive: update early and escalate any issues downstream as early as possible. Most dependabot PRs should be merged within a week. Complex upgrades like supporting a new major version of a commonly used library (for example protobuf), and may need to be completed across the ecosystem of packages. </span></li><li><span>For upgrades that require a significant amount of work, Beam maintainers should plan to complete the </span><strong>upgrade</strong><span> </span><strong>within a year after the next (major) version has been first released.</strong><span> The sooner, the better. </span></li></ul></li></ul><h2 id="DependencymanagementguidelinesforBeamPythonSDKmaintainers-Howtoaddanewdependency?"><span>How to add a new dependency?</span></h2><ul><li style="list-style-type: none;"><ul><li><span>Set the lower bound to some version you tested. Often, it's the latest available version for the package. </span></li><li><span>For libraries that claim to follow semantic versioning, cap the upper bound at the next major version. For example: &quot;some_package&gt;=1.4.0, some_package&lt;2&quot;</span></li><li><span>Depending on an exact version or a very narrow range is warranted only in exceptional cases, for example: pickling libraries ()</span></li><li><span>Using less-or-equal sign in upper bound is wrong (e.g. &quot;some_pacakge&lt;=2.0.0&quot;): this caps the upper bound to a specific version (2.0), excluding a possibility to make a patch release that the constraint will pick up. </span></li><li><span>For stable dependencies (only bugfix releases, stable api surface), open version bounds are acceptable. Example: 'pytz&gt;=2018.3'.</span></li><li><span>For other dependencies, use upper bounds at the next minor version or decide case by case. Example: 'numpy&gt;=1.14.3,&lt;1.25.0', </span><a class="external-link" href="https://github.com/apache/beam/blob/818c2b44e998529f3e5727a5d30b75922e0d113d/sdks/python/setup.py#L248-L250" rel="nofollow"><span>https://github.com/apache/beam/blob/818c2b44e998529f3e5727a5d30b75922e0d113d/sdks/python/setup.py#L248-L250</span></a><span>  </span></li><li><span>When a rationale behind a requirement spec is not obvious, explain in a comment.</span><span> </span></li></ul></li></ul><h2 id="DependencymanagementguidelinesforBeamPythonSDKmaintainers-Shouldtransitivedependenciesbeincluded?"><span>Should transitive dependencies be included?</span></h2><ul><li style="list-style-type: none;"><ul><li><span>Don't manage more than necessary.</span><span> Do not add constraints on transitive dependencies that are not direct dependencies.</span></li><li><span>If Beam directly uses a transitive dependency, Beam should also directly depend on it (include it in constraints).</span></li><li><span>If a transitive dependency causes issues, add it to our requirements with an appropriate upper bound and comment when such a requirement can be removed.</span></li></ul></li></ul><h2 id="DependencymanagementguidelinesforBeamPythonSDKmaintainers-WhattodowheninstallingBeamcausesbacktracking?"><span>What to do when installing Beam causes backtracking? </span></h2><ul><li style="list-style-type: none;"><ul><li><span>Installing Apache Beam should not require backtracking during dependency resolution: after pip evaluates the set of constraints, each package should be downloaded once. </span></li><li><span>This is generally possible when using the latest allowed version of each dependency leads to a compatible configuration.</span></li><li><span>When backtracking happens, it can be prevented by adding a constraint that caps the allowed version of a dependency to the last compatible version.</span></li></ul></li></ul><h2 id="DependencymanagementguidelinesforBeamPythonSDKmaintainers-Howtofindwhichdependenciesareoutdated?"><span>How to find which dependencies are outdated? </span></h2><ul><li style="list-style-type: none;"><ul><li><span><a href="https://cwiki.apache.org/confluence/display/BEAM/Python+Tips#PythonTips-HowtoupdatedependenciesthatareinstalledinPythoncontainerimages" rel="nofollow">Update Beam's base image requirements</a> (recommended).</span></li><li><span>Install Beam dependencies into a clean environment:  `pip install -r sdks/python/container/py310/base_image_requirements.txt` </span></li><li><span>Check for outdated dependencies: `pip list --outdated`.</span></li><li><span>Ideally, each outdated dependency from our direct dependency list should either have a Dependabot PR in flight or an issue tracking the upgrade. </span></li></ul></li></ul>